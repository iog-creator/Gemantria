version: 0.3
run_id: local-dev
tasks:
  - key: smoke_hello
    kind: print
    args:
      message: "hello, gemantria"

  - key: gate_presence_rules
    kind: grep
    args:
      file: "docs/SSOT/RULES_INDEX.md"
      patterns: ["037", "038"]

  - key: exports_presence_latest
    kind: file_glob
    args:
      globs: ["exports/graph_latest.json"]

  - key: exports_presence_all
    kind: file_glob
    args:
      globs: ["exports/graph_*.json"]

  - key: exports_edge_strength_spread_latest
    kind: json_assert
    args:
      file: "exports/graph_latest.json"
      asserts:
        - name: "edge strength fraction in [0.30,0.95]"
          path: "edges[*].strength"
          op: "frac_in_range"
          min: 0.30
          max: 0.95
          min_frac: 0.70

  - key: exports_nodes_dim_if_present_latest
    kind: json_assert
    args:
      file: "exports/graph_latest.json"
      asserts:
        - name: "nodes[*].embedding_dim==1024 if present"
          path: "nodes[*].embedding_dim"
          op: "if_present_eq_all"
          value: 1024

success_policy:
  mode: all_must_pass
