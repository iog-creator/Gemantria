{
  "schema": "control",
  "generated_at": "2025-11-21T04:36:50.007531+00:00",
  "tables": [
    {
      "name": "agent_run",
      "columns": [
        {
          "name": "id",
          "type": "uuid",
          "nullable": false,
          "default": "gen_random_uuid()"
        },
        {
          "name": "project_id",
          "type": "bigint",
          "nullable": false,
          "default": null
        },
        {
          "name": "session_id",
          "type": "uuid",
          "nullable": true,
          "default": null
        },
        {
          "name": "tool",
          "type": "text",
          "nullable": false,
          "default": null
        },
        {
          "name": "args_json",
          "type": "jsonb",
          "nullable": false,
          "default": null
        },
        {
          "name": "result_json",
          "type": "jsonb",
          "nullable": false,
          "default": null
        },
        {
          "name": "violations_json",
          "type": "jsonb",
          "nullable": false,
          "default": "'[]'::jsonb"
        },
        {
          "name": "created_at",
          "type": "timestamp with time zone",
          "nullable": false,
          "default": "now()"
        }
      ],
      "primary_key": [
        "id"
      ],
      "indexes": [
        {
          "name": "idx_agent_run_created",
          "columns": [
            "created_at"
          ]
        },
        {
          "name": "idx_agent_run_project",
          "columns": [
            "project_id"
          ]
        },
        {
          "name": "idx_agent_run_session",
          "columns": [
            "session_id"
          ]
        },
        {
          "name": "idx_agent_run_tool",
          "columns": [
            "tool"
          ]
        },
        {
          "name": "idx_agent_run_violations",
          "columns": [
            "violations_json"
          ]
        }
      ],
      "foreign_keys": [
        {
          "constraint": "agent_run_session_id_fkey",
          "column": "session_id",
          "references": "control.capability_session",
          "referenced_column": "id"
        }
      ]
    },
    {
      "name": "capability_rule",
      "columns": [
        {
          "name": "id",
          "type": "uuid",
          "nullable": false,
          "default": "gen_random_uuid()"
        },
        {
          "name": "project_id",
          "type": "bigint",
          "nullable": false,
          "default": null
        },
        {
          "name": "name",
          "type": "text",
          "nullable": false,
          "default": null
        },
        {
          "name": "ring",
          "type": "integer",
          "nullable": false,
          "default": null
        },
        {
          "name": "allowlist",
          "type": "ARRAY",
          "nullable": true,
          "default": null
        },
        {
          "name": "denylist",
          "type": "ARRAY",
          "nullable": true,
          "default": null
        },
        {
          "name": "budgets",
          "type": "jsonb",
          "nullable": false,
          "default": "'{}'::jsonb"
        },
        {
          "name": "created_at",
          "type": "timestamp with time zone",
          "nullable": false,
          "default": "now()"
        }
      ],
      "primary_key": [
        "id"
      ],
      "indexes": [
        {
          "name": "capability_rule_project_id_name_key",
          "columns": [
            "project_id",
            "name"
          ]
        },
        {
          "name": "idx_capability_rule_project",
          "columns": [
            "project_id"
          ]
        },
        {
          "name": "idx_capability_rule_ring",
          "columns": [
            "ring"
          ]
        }
      ],
      "foreign_keys": []
    },
    {
      "name": "capability_session",
      "columns": [
        {
          "name": "id",
          "type": "uuid",
          "nullable": false,
          "default": "gen_random_uuid()"
        },
        {
          "name": "project_id",
          "type": "bigint",
          "nullable": false,
          "default": null
        },
        {
          "name": "rule_id",
          "type": "uuid",
          "nullable": false,
          "default": null
        },
        {
          "name": "por_json",
          "type": "jsonb",
          "nullable": false,
          "default": null
        },
        {
          "name": "tiny_menu",
          "type": "ARRAY",
          "nullable": false,
          "default": null
        },
        {
          "name": "ttl_s",
          "type": "integer",
          "nullable": false,
          "default": null
        },
        {
          "name": "created_at",
          "type": "timestamp with time zone",
          "nullable": false,
          "default": "now()"
        }
      ],
      "primary_key": [
        "id"
      ],
      "indexes": [
        {
          "name": "idx_capability_session_created",
          "columns": [
            "created_at"
          ]
        },
        {
          "name": "idx_capability_session_project",
          "columns": [
            "project_id"
          ]
        },
        {
          "name": "idx_capability_session_rule",
          "columns": [
            "rule_id"
          ]
        }
      ],
      "foreign_keys": [
        {
          "constraint": "capability_session_rule_id_fkey",
          "column": "rule_id",
          "references": "control.capability_rule",
          "referenced_column": "id"
        }
      ]
    },
    {
      "name": "doc_embedding",
      "columns": [
        {
          "name": "id",
          "type": "bigint",
          "nullable": false,
          "default": "nextval('control.doc_embedding_id_seq'::regclass)"
        },
        {
          "name": "fragment_id",
          "type": "uuid",
          "nullable": false,
          "default": null
        },
        {
          "name": "model_name",
          "type": "text",
          "nullable": false,
          "default": null
        },
        {
          "name": "embedding",
          "type": "USER-DEFINED",
          "nullable": false,
          "default": null
        },
        {
          "name": "created_at",
          "type": "timestamp with time zone",
          "nullable": false,
          "default": "now()"
        }
      ],
      "primary_key": [
        "id"
      ],
      "indexes": [
        {
          "name": "idx_doc_embedding_fragment_id",
          "columns": [
            "fragment_id"
          ]
        },
        {
          "name": "idx_doc_embedding_fragment_model_unique",
          "columns": [
            "fragment_id",
            "model_name"
          ]
        },
        {
          "name": "idx_doc_embedding_model_name",
          "columns": [
            "model_name"
          ]
        }
      ],
      "foreign_keys": [
        {
          "constraint": "doc_embedding_fragment_id_fkey",
          "column": "fragment_id",
          "references": "control.doc_fragment",
          "referenced_column": "id"
        }
      ]
    },
    {
      "name": "doc_fragment",
      "columns": [
        {
          "name": "id",
          "type": "uuid",
          "nullable": false,
          "default": "gen_random_uuid()"
        },
        {
          "name": "project_id",
          "type": "bigint",
          "nullable": true,
          "default": null
        },
        {
          "name": "src",
          "type": "text",
          "nullable": true,
          "default": null
        },
        {
          "name": "anchor",
          "type": "text",
          "nullable": true,
          "default": null
        },
        {
          "name": "sha256",
          "type": "text",
          "nullable": true,
          "default": null
        },
        {
          "name": "created_at",
          "type": "timestamp with time zone",
          "nullable": false,
          "default": "now()"
        },
        {
          "name": "doc_id",
          "type": "uuid",
          "nullable": true,
          "default": null
        },
        {
          "name": "version_id",
          "type": "bigint",
          "nullable": true,
          "default": null
        },
        {
          "name": "fragment_index",
          "type": "integer",
          "nullable": true,
          "default": null
        },
        {
          "name": "fragment_type",
          "type": "text",
          "nullable": true,
          "default": null
        },
        {
          "name": "content",
          "type": "text",
          "nullable": true,
          "default": null
        },
        {
          "name": "updated_at",
          "type": "timestamp with time zone",
          "nullable": true,
          "default": "now()"
        }
      ],
      "primary_key": [
        "id"
      ],
      "indexes": [
        {
          "name": "doc_fragment_project_id_src_anchor_key",
          "columns": [
            "project_id",
            "src",
            "anchor"
          ]
        },
        {
          "name": "idx_doc_fragment_content_unique",
          "columns": [
            "doc_id",
            "version_id",
            "fragment_index"
          ]
        },
        {
          "name": "idx_doc_fragment_doc_id",
          "columns": [
            "doc_id"
          ]
        },
        {
          "name": "idx_doc_fragment_project",
          "columns": [
            "project_id"
          ]
        },
        {
          "name": "idx_doc_fragment_sha256",
          "columns": [
            "sha256"
          ]
        },
        {
          "name": "idx_doc_fragment_src",
          "columns": [
            "src"
          ]
        },
        {
          "name": "idx_doc_fragment_type",
          "columns": [
            "fragment_type"
          ]
        },
        {
          "name": "idx_doc_fragment_version_id",
          "columns": [
            "version_id"
          ]
        }
      ],
      "foreign_keys": [
        {
          "constraint": "doc_fragment_doc_id_fkey",
          "column": "doc_id",
          "references": "control.doc_registry",
          "referenced_column": "doc_id"
        },
        {
          "constraint": "doc_fragment_version_id_fkey",
          "column": "version_id",
          "references": "control.doc_version",
          "referenced_column": "id"
        }
      ]
    },
    {
      "name": "doc_registry",
      "columns": [
        {
          "name": "doc_id",
          "type": "uuid",
          "nullable": false,
          "default": "gen_random_uuid()"
        },
        {
          "name": "logical_name",
          "type": "text",
          "nullable": false,
          "default": null
        },
        {
          "name": "role",
          "type": "text",
          "nullable": false,
          "default": null
        },
        {
          "name": "repo_path",
          "type": "text",
          "nullable": false,
          "default": null
        },
        {
          "name": "share_path",
          "type": "text",
          "nullable": true,
          "default": null
        },
        {
          "name": "is_ssot",
          "type": "boolean",
          "nullable": false,
          "default": null
        },
        {
          "name": "enabled",
          "type": "boolean",
          "nullable": false,
          "default": "true"
        },
        {
          "name": "created_at",
          "type": "timestamp with time zone",
          "nullable": false,
          "default": "now()"
        },
        {
          "name": "updated_at",
          "type": "timestamp with time zone",
          "nullable": false,
          "default": "now()"
        }
      ],
      "primary_key": [
        "doc_id"
      ],
      "indexes": [
        {
          "name": "doc_registry_logical_name_key",
          "columns": [
            "logical_name"
          ]
        }
      ],
      "foreign_keys": []
    },
    {
      "name": "doc_sync_state",
      "columns": [
        {
          "name": "id",
          "type": "bigint",
          "nullable": false,
          "default": "nextval('control.doc_sync_state_id_seq'::regclass)"
        },
        {
          "name": "doc_id",
          "type": "uuid",
          "nullable": false,
          "default": null
        },
        {
          "name": "target",
          "type": "text",
          "nullable": false,
          "default": null
        },
        {
          "name": "last_synced_at",
          "type": "timestamp with time zone",
          "nullable": true,
          "default": null
        },
        {
          "name": "last_hash",
          "type": "text",
          "nullable": true,
          "default": null
        },
        {
          "name": "status",
          "type": "text",
          "nullable": false,
          "default": null
        },
        {
          "name": "message",
          "type": "text",
          "nullable": true,
          "default": null
        },
        {
          "name": "updated_at",
          "type": "timestamp with time zone",
          "nullable": false,
          "default": "now()"
        }
      ],
      "primary_key": [
        "id"
      ],
      "indexes": [],
      "foreign_keys": [
        {
          "constraint": "doc_sync_state_doc_id_fkey",
          "column": "doc_id",
          "references": "control.doc_registry",
          "referenced_column": "doc_id"
        }
      ]
    },
    {
      "name": "doc_version",
      "columns": [
        {
          "name": "id",
          "type": "bigint",
          "nullable": false,
          "default": "nextval('control.doc_version_id_seq'::regclass)"
        },
        {
          "name": "doc_id",
          "type": "uuid",
          "nullable": false,
          "default": null
        },
        {
          "name": "git_commit",
          "type": "text",
          "nullable": true,
          "default": null
        },
        {
          "name": "content_hash",
          "type": "text",
          "nullable": false,
          "default": null
        },
        {
          "name": "size_bytes",
          "type": "bigint",
          "nullable": false,
          "default": null
        },
        {
          "name": "recorded_at",
          "type": "timestamp with time zone",
          "nullable": false,
          "default": "now()"
        }
      ],
      "primary_key": [
        "id"
      ],
      "indexes": [],
      "foreign_keys": [
        {
          "constraint": "doc_version_doc_id_fkey",
          "column": "doc_id",
          "references": "control.doc_registry",
          "referenced_column": "doc_id"
        }
      ]
    },
    {
      "name": "guard_definition",
      "columns": [
        {
          "name": "guard_id",
          "type": "text",
          "nullable": false,
          "default": null
        },
        {
          "name": "name",
          "type": "text",
          "nullable": false,
          "default": null
        },
        {
          "name": "description",
          "type": "text",
          "nullable": true,
          "default": null
        },
        {
          "name": "rule_ids",
          "type": "ARRAY",
          "nullable": false,
          "default": "'{}'::text[]"
        },
        {
          "name": "strict_default",
          "type": "boolean",
          "nullable": false,
          "default": "false"
        },
        {
          "name": "script_path",
          "type": "text",
          "nullable": true,
          "default": null
        },
        {
          "name": "created_at",
          "type": "timestamp with time zone",
          "nullable": false,
          "default": "now()"
        }
      ],
      "primary_key": [
        "guard_id"
      ],
      "indexes": [],
      "foreign_keys": []
    },
    {
      "name": "kb_document",
      "columns": [
        {
          "name": "id",
          "type": "uuid",
          "nullable": false,
          "default": "gen_random_uuid()"
        },
        {
          "name": "path",
          "type": "text",
          "nullable": false,
          "default": null
        },
        {
          "name": "title",
          "type": "text",
          "nullable": true,
          "default": null
        },
        {
          "name": "doc_type",
          "type": "text",
          "nullable": true,
          "default": null
        },
        {
          "name": "project",
          "type": "text",
          "nullable": false,
          "default": "'Gemantria.v2'::text"
        },
        {
          "name": "content_hash",
          "type": "text",
          "nullable": false,
          "default": null
        },
        {
          "name": "size_bytes",
          "type": "integer",
          "nullable": false,
          "default": null
        },
        {
          "name": "mtime",
          "type": "timestamp with time zone",
          "nullable": false,
          "default": null
        },
        {
          "name": "referenced_by",
          "type": "ARRAY",
          "nullable": true,
          "default": "'{}'::text[]"
        },
        {
          "name": "is_canonical",
          "type": "boolean",
          "nullable": false,
          "default": "false"
        },
        {
          "name": "status",
          "type": "text",
          "nullable": false,
          "default": "'unreviewed'::text"
        },
        {
          "name": "created_at",
          "type": "timestamp with time zone",
          "nullable": false,
          "default": "now()"
        },
        {
          "name": "updated_at",
          "type": "timestamp with time zone",
          "nullable": false,
          "default": "now()"
        }
      ],
      "primary_key": [
        "id"
      ],
      "indexes": [
        {
          "name": "idx_kb_document_content_hash",
          "columns": [
            "content_hash"
          ]
        },
        {
          "name": "idx_kb_document_doc_type",
          "columns": [
            "doc_type"
          ]
        },
        {
          "name": "idx_kb_document_path",
          "columns": [
            "path"
          ]
        },
        {
          "name": "idx_kb_document_project_hash",
          "columns": [
            "project",
            "content_hash"
          ]
        },
        {
          "name": "idx_kb_document_status",
          "columns": [
            "status"
          ]
        },
        {
          "name": "kb_document_path_key",
          "columns": [
            "path"
          ]
        }
      ],
      "foreign_keys": []
    },
    {
      "name": "rule_definition",
      "columns": [
        {
          "name": "rule_id",
          "type": "text",
          "nullable": false,
          "default": null
        },
        {
          "name": "name",
          "type": "text",
          "nullable": false,
          "default": null
        },
        {
          "name": "status",
          "type": "text",
          "nullable": false,
          "default": null
        },
        {
          "name": "description",
          "type": "text",
          "nullable": true,
          "default": null
        },
        {
          "name": "severity",
          "type": "text",
          "nullable": false,
          "default": null
        },
        {
          "name": "docs_path",
          "type": "text",
          "nullable": true,
          "default": null
        },
        {
          "name": "created_at",
          "type": "timestamp with time zone",
          "nullable": false,
          "default": "now()"
        },
        {
          "name": "updated_at",
          "type": "timestamp with time zone",
          "nullable": false,
          "default": "now()"
        }
      ],
      "primary_key": [
        "rule_id"
      ],
      "indexes": [],
      "foreign_keys": []
    },
    {
      "name": "rule_source",
      "columns": [
        {
          "name": "id",
          "type": "bigint",
          "nullable": false,
          "default": "nextval('control.rule_source_id_seq'::regclass)"
        },
        {
          "name": "rule_id",
          "type": "text",
          "nullable": false,
          "default": null
        },
        {
          "name": "source_type",
          "type": "text",
          "nullable": false,
          "default": null
        },
        {
          "name": "path",
          "type": "text",
          "nullable": false,
          "default": null
        },
        {
          "name": "content_hash",
          "type": "text",
          "nullable": false,
          "default": null
        },
        {
          "name": "created_at",
          "type": "timestamp with time zone",
          "nullable": false,
          "default": "now()"
        }
      ],
      "primary_key": [
        "id"
      ],
      "indexes": [],
      "foreign_keys": [
        {
          "constraint": "rule_source_rule_id_fkey",
          "column": "rule_id",
          "references": "control.rule_definition",
          "referenced_column": "rule_id"
        }
      ]
    },
    {
      "name": "system_state_ledger",
      "columns": [
        {
          "name": "id",
          "type": "uuid",
          "nullable": false,
          "default": "gen_random_uuid()"
        },
        {
          "name": "name",
          "type": "text",
          "nullable": false,
          "default": null
        },
        {
          "name": "source_of_truth",
          "type": "text",
          "nullable": false,
          "default": null
        },
        {
          "name": "hash",
          "type": "text",
          "nullable": false,
          "default": null
        },
        {
          "name": "generated_at",
          "type": "timestamp with time zone",
          "nullable": false,
          "default": "now()"
        },
        {
          "name": "verified_at",
          "type": "timestamp with time zone",
          "nullable": true,
          "default": null
        },
        {
          "name": "status",
          "type": "text",
          "nullable": false,
          "default": "'unknown'::text"
        }
      ],
      "primary_key": [
        "id"
      ],
      "indexes": [
        {
          "name": "idx_system_state_ledger_name",
          "columns": [
            "name"
          ]
        },
        {
          "name": "idx_system_state_ledger_source",
          "columns": [
            "source_of_truth"
          ]
        },
        {
          "name": "idx_system_state_ledger_status",
          "columns": [
            "status"
          ]
        }
      ],
      "foreign_keys": []
    },
    {
      "name": "tool_catalog",
      "columns": [
        {
          "name": "id",
          "type": "uuid",
          "nullable": false,
          "default": "gen_random_uuid()"
        },
        {
          "name": "project_id",
          "type": "bigint",
          "nullable": false,
          "default": null
        },
        {
          "name": "name",
          "type": "text",
          "nullable": false,
          "default": null
        },
        {
          "name": "ring",
          "type": "integer",
          "nullable": false,
          "default": null
        },
        {
          "name": "io_schema",
          "type": "jsonb",
          "nullable": false,
          "default": null
        },
        {
          "name": "enabled",
          "type": "boolean",
          "nullable": false,
          "default": "true"
        },
        {
          "name": "created_at",
          "type": "timestamp with time zone",
          "nullable": false,
          "default": "now()"
        }
      ],
      "primary_key": [
        "id"
      ],
      "indexes": [
        {
          "name": "idx_tool_catalog_enabled",
          "columns": [
            "enabled"
          ]
        },
        {
          "name": "idx_tool_catalog_project",
          "columns": [
            "project_id"
          ]
        },
        {
          "name": "idx_tool_catalog_ring",
          "columns": [
            "ring"
          ]
        },
        {
          "name": "tool_catalog_project_id_name_key",
          "columns": [
            "project_id",
            "name"
          ]
        }
      ],
      "foreign_keys": []
    }
  ]
}