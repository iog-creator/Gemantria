{
  "schema": "file_head.v1",
  "generated_at": "2025-12-07T18:49:10.945888+00:00",
  "file_path": "/home/mccoy/Projects/Gemantria.v2/AGENTS.md",
  "exists": true,
  "line_count": 1733,
  "head_lines": [
    "# AGENTS.md \u2014 Gemantria Agent Framework",
    "<!-- alwaysapply.sentinel: 050,051,052 source=ai_interactions -->",
    "",
    "> **AGENT REGISTRY ROLE: CANONICAL_GLOBAL**  ",
    "> Source of truth for the Gemantria agent roster (IDs, roles, subsystems, tools, workflows, governance).  ",
    "> Derived views: `pmagent/kb/AGENTS.md` (PM-focused), `pmagent/tests/*/AGENTS.md` (test-specific), other subsystem-specific summaries.  ",
    "> Last reviewed: 2025-12-03",
    "",
    "> **Always-Apply Triad**: We operate under **Rule-050 (LOUD FAIL)**, **Rule-051 (CI gating)**, and **Rule-052 (tool-priority)**. The guards ensure this 050/051/052 triad is present in docs and mirrored in DB checks.",
    "",
    "## Canonical Agents Table (Draft from KB Registry)",
    "",
    "The following table was generated from **share/AGENTS_REGISTRY_SNAPSHOT.json** to reflect the currently registered agents in the KB/DMS registry.",
    "",
    "<!-- BEGIN: AUTO-GENERATED AGENTS TABLE -->",
    "| Agent ID | Path | Subsystem | Tags |",
    "|----------|------|-----------|------|",
    "| agents::agentpm/kb/agents.md | agentpm/kb/AGENTS.md | ops | ssot, agent_framework |",
    "| agents::agentpm/knowledge/agents.md | agentpm/knowledge/AGENTS.md | ops | ssot, agent_framework |",
    "| agents::agentpm/metrics/agents.md | agentpm/metrics/AGENTS.md | ops | ssot, agent_framework |",
    "| agents::agentpm/rpc/agents.md | agentpm/rpc/AGENTS.md | ops | ssot, agent_framework |",
    "| agents::agentpm/tests/kb/agents.md | agentpm/tests/kb/AGENTS.md | general | ssot, agent_framework |",
    "| agents::agentpm/tests/status/agents.md | agentpm/tests/status/AGENTS.md | ops | ssot, agent_framework |",
    "| agents::docs/audits/agents.md | docs/audits/AGENTS.md | ops | ssot, agent_framework |",
    "| agents::src/gemantria.egg-info/agents.md | src/gemantria.egg-info/AGENTS.md | gematria | ssot, agent_framework |",
    "<!-- END: AUTO-GENERATED AGENTS TABLE -->",
    "",
    "## Directory Purpose",
    "",
    "The root `AGENTS.md` serves as the primary agent framework documentation for the Gemantria repository, defining mission, priorities, environment, workflows, and governance for all agentic operations across the codebase.",
    "",
    "## Mission",
    "Build a deterministic, resumable LangGraph pipeline that produces verified gematria data and viz-ready artifacts.",
    "",
    "## Priorities",
    "1) Correctness: **Code gematria > bible_db > LLM (LLM = metadata only)**.",
    "2) Determinism: content_hash identity; uuidv7 surrogate; fixed seeds; position_index.",
    "3) Safety: **bible_db is READ-ONLY**; parameterized SQL only; **fail-closed if <50 nouns** (ALLOW_PARTIAL=1 is explicit).",
    "- **DMS Lifecycle Policy**:",
    "    - **Exclusive SSOT**: `control.doc_registry` is the ONLY authority for document existence and status.",
    "    - **Lifecycle**: `importance` and `enabled` columns determine if a doc is Core, Helpful, or Archived.",
    "    - **Pathing**: Filesystem locations must reflect DMS `repo_path`.",
    "",
    "## pmagent Status",
    "",
    "See `docs/SSOT/PMAGENT_CURRENT_VS_INTENDED.md` for current vs intended state of pmagent commands and capabilities.",
    "",
    "See `docs/SSOT/PMAGENT_REALITY_CHECK_DESIGN.md` for reality.check implementation design and validation schema.",
    "",
    "## PM DMS Integration (Rule-053) \u2b50 NEW",
    "",
    "**Phase 9.1**: PM must query **Postgres DMS (control plane)** BEFORE file searching.",
    "",
    "**DMS-First Workflow**:",
    "1. **Documentation**: `pmagent kb registry by-subsystem --owning-subsystem=<project>`",
    "2. **Tool Catalog**: `SELECT * FROM control.mcp_tool_catalog WHERE tags @> '{<project>}'`",
    "3. **Project Status**: `pmagent status kb` and `pmagent plan kb list`",
    "4. **File Search** (LAST RESORT): Only if content not in DMS",
    "",
    "**Feature Registration**:",
    "- After building new tool/module: Create MCP envelope \u2192 `make mcp.ingest` \u2192 Update KB registry",
    "- PM learns capabilities automatically through DMS registration",
    "- **Goal**: PM and project develop together",
    "",
    "See `.cursor/rules/053-pm-dms-integration.mdc` and `docs/SSOT/PM_CONTRACT.md` Section 2.6 for full workflow.",
    "",
    "## Environment",
    "- venv: `python -m venv .venv && source .venv/bin/activate`",
    "- install: `make deps`",
    "- Databases:",
    "  - `BIBLE_DB_DSN` \u2014 read-only Bible database (RO adapter denies writes pre-connection)",
    "  - `GEMATRIA_DSN` \u2014 read/write application database",
    "- **DSN Access**: All DSN access must go through centralized loaders:",
    "  - **Preferred**: `scripts.config.env` (`get_rw_dsn()`, `get_ro_dsn()`, `get_bible_db_dsn()`)",
    "  - **Legacy**: `src.gemantria.dsn` (`dsn_rw()`, `dsn_ro()`, `dsn_atlas()`)",
    "  - Never use `os.getenv(\"GEMATRIA_DSN\")` directly - enforced by `guard.dsn.centralized`",
    "",
    "### 3-Role DB Contract (OPS v6.2.3)",
    "**Extraction DB**: `GEMATRIA_DSN` \u2192 database `gematria`  ",
    "**SSOT DB**: `BIBLE_DB_DSN` \u2192 database `bible_db` (read-only)  ",
    "**AI Tracking**: **lives in `gematria` DB**, `public` schema; `AI_AUTOMATION_DSN` **must equal** `GEMATRIA_DSN`.  ",
    "Guards: `guard.rules.alwaysapply.dbmirror` (triad), `guard.ai.tracking` (tables `public.ai_interactions`, `public.governance_artifacts`).  ",
    "CI posture: HINT on PRs; STRICT on tags behind `vars.STRICT_DB_MIRROR_CI == '1'`.",
    "- Batch & overrides:",
    "  - `BATCH_SIZE=50` (default noun batch size)",
    "  - `ALLOW_PARTIAL=0|1` (if 1, manifest must capture reason)",
    "  - `PARTIAL_REASON=<string>` (required when ALLOW_PARTIAL=1)",
    "- Checkpointer: `CHECKPOINTER=postgres|memory` (default: memory for CI/dev)",
    "- LLM: Local inference providers (LM Studio or Ollama) when enabled; confidence is metadata only.",
    "  - **Inference Providers** (Phase-7E): Supports both LM Studio and Ollama via `INFERENCE_PROVIDER`:",
    "    - `lmstudio`: OpenAI-compatible API (`OPENAI_BASE_URL`) - **Granite models available in LM Studio**",
    "    - `ollama`: Native HTTP API (`OLLAMA_BASE_URL`) - **Granite models also available via Ollama**",
    "  - **Setup**: See `docs/runbooks/LM_STUDIO_SETUP.md` for LM Studio setup or `docs/runbooks/OLLAMA_ALTERNATIVE.md` for Ollama",
    "  - **Quick Start (LM Studio)**: Set `INFERENCE_PROVIDER=lmstudio`, `LM_STUDIO_ENABLED=1`, `OPENAI_BASE_URL=http://127.0.0.1:9994/v1`",
    "  - **Quick Start (Ollama)**: Set `INFERENCE_PROVIDER=ollama`, `OLLAMA_BASE_URL=http://127.0.0.1:11434`, then `ollama pull ibm/granite4.0-preview:tiny`",
    "  - **Health Check**: `pmagent health lm` verifies inference provider availability",
    "  - **Default Models (Phase-7F)**: ",
    "    - **Default stack**: Granite embedding + Granite reranker + Granite local agent.",
    "      - `LOCAL_AGENT_MODEL=granite4:tiny-h` (Ollama)",
    "      - `EMBEDDING_MODEL=granite-embedding:278m` (Granite)"
  ],
  "head_line_count": 100,
  "error": null
}