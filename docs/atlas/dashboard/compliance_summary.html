<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Compliance Summary Dashboard — E86</title>
<style>
body { font-family: system-ui, -apple-system, sans-serif; max-width: 1200px; margin: 2em auto; padding: 0 1em; line-height: 1.6; }
h1 { color: #1a1a1a; border-bottom: 2px solid #ddd; padding-bottom: 0.5em; }
h2 { color: #333; margin-top: 1.5em; }
.tile { border: 1px solid #ddd; border-radius: 8px; padding: 1em; margin: 1em 0; background: #f9f9f9; }
.tile h3 { margin-top: 0; color: #555; }
.metric { display: inline-block; margin: 0.5em 1em 0.5em 0; padding: 0.5em 1em; background: white; border-radius: 4px; border: 1px solid #ccc; }
.metric-value { font-size: 1.5em; font-weight: bold; color: #0066cc; }
.metric-label { font-size: 0.9em; color: #666; }
table { width: 100%; border-collapse: collapse; margin: 1em 0; }
th, td { padding: 0.5em; text-align: left; border-bottom: 1px solid #ddd; }
th { background: #f0f0f0; font-weight: bold; }
.backlinks { background: #f5f5f5; padding: 1em; border-radius: 8px; margin: 1em 0; }
.backlinks ul { list-style: none; padding: 0; }
.backlinks li { margin: 0.5em 0; }
.backlinks a { color: #0066cc; text-decoration: none; }
.backlinks a:hover { text-decoration: underline; }
.badge { display: inline-block; background: #eef; border: 1px solid #ccd; border-radius: 4px; padding: 2px 8px; font-size: 0.85rem; margin-left: 0.5em; }
.loading { color: #666; font-style: italic; }
.error { color: #dc3545; }
.ok { color: #28a745; }
</style>
</head>
<body>
<h1>Compliance Summary Dashboard <span class="badge">E86</span></h1>
<p><a href="../index.html">← Back to Atlas</a></p>

<div id="dashboard-content">
  <div class="loading">Loading compliance metrics...</div>
</div>

<div class="backlinks">
<h2>Evidence Backlinks</h2>
<ul>
  <li><a href="../../../share/atlas/control_plane/compliance_summary.json" data-testid="backlink-compliance-summary-json">Raw JSON: share/atlas/control_plane/compliance_summary.json</a></li>
  <li><a href="../../../share/atlas/control_plane/compliance.head.json" data-testid="backlink-compliance-head-json">Raw JSON: share/atlas/control_plane/compliance.head.json</a></li>
  <li><a href="../../../share/atlas/control_plane/top_violations_7d.json" data-testid="backlink-top-violations-7d-json">Raw JSON: share/atlas/control_plane/top_violations_7d.json</a></li>
  <li><a href="../../../share/atlas/control_plane/top_violations_30d.json" data-testid="backlink-top-violations-30d-json">Raw JSON: share/atlas/control_plane/top_violations_30d.json</a></li>
  <li><a href="../../../evidence/guard_atlas_compliance_summary.json" data-testid="backlink-guard-atlas-compliance-summary-json">Guard Verdict: evidence/guard_atlas_compliance_summary.json</a></li>
  <li><a href="../browser/biblescholar_reference.html" data-testid="backlink-biblescholar-reference">BibleScholar Reference Answer Slice (Phase-6P)</a></li>
  <li><a href="../../../share/atlas/control_plane/graph_compliance.json" data-testid="backlink-graph-compliance-json">Raw JSON: share/atlas/control_plane/graph_compliance.json</a></li>
  <li><a href="/docs/runbooks/PHASE_6D_DOWNSTREAM_INTEGRATION.md" rel="external" data-external="true" data-testid="backlink-phase6d-runbook">Phase-6D Integration Guide (Downstream Apps)</a></li>
  <li><a href="../../../share/atlas/control_plane/mcp_status_cards.json" data-testid="backlink-mcp-status-cards-json">Raw JSON: share/atlas/control_plane/mcp_status_cards.json (PLAN-072 M3)</a></li>
  <li><a href="../../../share/mcp/por_proof.json" data-testid="backlink-por-proof-json">E21 POR Proof: share/mcp/por_proof.json</a></li>
  <li><a href="../../../share/mcp/schema_proof.json" data-testid="backlink-schema-proof-json">E22 Schema Proof: share/mcp/schema_proof.json</a></li>
  <li><a href="../../../share/mcp/gatekeeper_proof.json" data-testid="backlink-gatekeeper-proof-json">E23 Gatekeeper Proof: share/mcp/gatekeeper_proof.json</a></li>
  <li><a href="../../../share/mcp/tagproof_proof.json" data-testid="backlink-tagproof-proof-json">E24 Tagproof Proof: share/mcp/tagproof_proof.json</a></li>
  <li><a href="../../../share/mcp/bundle_proof.json" data-testid="backlink-bundle-proof-json">E25 Bundle Proof: share/mcp/bundle_proof.json</a></li>
</ul>
</div>

<script>
(function() {
  const contentDiv = document.getElementById('dashboard-content');
  
  // Load compliance_summary.json
  fetch('../../../share/atlas/control_plane/compliance_summary.json')
    .then(r => r.ok ? r.json() : Promise.reject(new Error('Failed to load compliance_summary.json')))
    .then(data => {
      const metrics = data.metrics || {};
      const totalViolations = metrics.total_violations || {};
      const byCode = metrics.violations_by_code || {};
      const byTool = metrics.violations_by_tool || {};
      const topOffenders = metrics.top_offenders || [];
      
      let html = '';
      
      // Total Violations Tile
      html += '<div class="tile">';
      html += '<h3>Total Violations</h3>';
      html += '<div class="metric"><span class="metric-value">' + (totalViolations['24h'] || 0) + '</span><br><span class="metric-label">24h</span></div>';
      html += '<div class="metric"><span class="metric-value">' + (totalViolations['7d'] || 0) + '</span><br><span class="metric-label">7d</span></div>';
      html += '<div class="metric"><span class="metric-value">' + (totalViolations['30d'] || 0) + '</span><br><span class="metric-label">30d</span></div>';
      html += '</div>';
      
      // Violations by Code Tile
      if (Object.keys(byCode).length > 0) {
        html += '<div class="tile">';
        html += '<h3>Violations by Code</h3>';
        html += '<table><thead><tr><th>Violation Code</th><th>7d</th><th>30d</th></tr></thead><tbody>';
        for (const [code, counts] of Object.entries(byCode)) {
          html += '<tr><td>' + code + '</td><td>' + (counts['7d'] || 0) + '</td><td>' + (counts['30d'] || 0) + '</td></tr>';
        }
        html += '</tbody></table>';
        html += '</div>';
      }
      
      // Violations by Tool Tile
      if (Object.keys(byTool).length > 0) {
        html += '<div class="tile">';
        html += '<h3>Violations by Tool</h3>';
        html += '<table><thead><tr><th>Tool</th><th>7d</th><th>30d</th></tr></thead><tbody>';
        for (const [tool, counts] of Object.entries(byTool)) {
          html += '<tr><td>' + tool + '</td><td>' + (counts['7d'] || 0) + '</td><td>' + (counts['30d'] || 0) + '</td></tr>';
        }
        html += '</tbody></table>';
        html += '</div>';
      }
      
      // MCP Status Cards Tile (PLAN-072 M3)
      fetch('../../../share/atlas/control_plane/mcp_status_cards.json')
        .then(r => r.ok ? r.json() : Promise.reject(new Error('Failed to load mcp_status_cards.json')))
        .then(mcpData => {
          const cards = mcpData.cards || {};
          const summary = mcpData.summary || {};
          
          html += '<div class="tile">';
          html += '<h3>MCP Proof Status (E21-E25)</h3>';
          html += '<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1em; margin-top: 1em;">';
          
          const cardOrder = ['e21_por', 'e22_schema', 'e23_gatekeeper', 'e24_tagproof', 'e25_bundle'];
          for (const cardName of cardOrder) {
            const card = cards[cardName];
            if (card) {
              const statusClass = card.ok ? 'ok' : 'error';
              html += '<div style="border: 1px solid #ddd; border-radius: 4px; padding: 0.75em; background: white;">';
              html += '<div style="font-weight: bold; margin-bottom: 0.5em;">' + card.label + '</div>';
              html += '<div class="' + statusClass + '" style="font-size: 0.9em;">Status: ' + card.status.toUpperCase() + '</div>';
              if (card.details && card.details.generated_at) {
                html += '<div style="font-size: 0.8em; color: #666; margin-top: 0.5em;">' + new Date(card.details.generated_at).toLocaleString() + '</div>';
              }
              html += '</div>';
            }
          }
          
          html += '</div>';
          html += '<div style="margin-top: 1em; padding-top: 1em; border-top: 1px solid #ddd;">';
          html += '<div class="metric"><span class="metric-value">' + (summary.ok_count || 0) + '</span><br><span class="metric-label">OK</span></div>';
          html += '<div class="metric"><span class="metric-value">' + (summary.failed_count || 0) + '</span><br><span class="metric-label">Failed</span></div>';
          html += '<div class="metric"><span class="metric-value">' + (summary.total_cards || 0) + '</span><br><span class="metric-label">Total</span></div>';
          html += '</div>';
          html += '</div>';
          
          contentDiv.innerHTML = html;
        })
        .catch(err => {
          console.error('Error loading MCP status cards:', err);
          // Continue with existing content even if MCP cards fail
        });
      
      // Top Offenders Tile
      if (topOffenders.length > 0) {
        html += '<div class="tile">';
        html += '<h3>Top Offenders</h3>';
        html += '<table><thead><tr><th>Code</th><th>Count</th></tr></thead><tbody>';
        for (const offender of topOffenders) {
          html += '<tr><td>' + offender.code + '</td><td>' + offender.count + '</td></tr>';
        }
        html += '</tbody></table>';
        html += '</div>';
      }
      
      if (html === '') {
        html = '<div class="tile"><p class="error">No compliance data available. Ensure compliance exports are generated.</p></div>';
      }
      
      contentDiv.innerHTML = html;
    })
    .catch(err => {
      contentDiv.innerHTML = '<div class="tile"><p class="error">Error loading compliance metrics: ' + err.message + '</p></div>';
    });
})();
</script>

<hr>
<small>Generated at <span id="generated-at"></span></small>
<script>
  document.getElementById('generated-at').textContent = new Date().toISOString();
</script>
</body>
</html>

