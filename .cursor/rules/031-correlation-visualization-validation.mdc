---
description: Validate correlation visualization exports and reporting
globs:
  - "scripts/export_graph.py"
  - "webui/graph/CorrelationExplorer.tsx"
  - "docs/SSOT/graph-stats.schema.json"
alwaysApply: false
---

# Rule 031 — Correlation Visualization Validation

**Status:** Active (Phase 5-C)

**Purpose:** Ensure correlation visualization exports and Web UI components are properly implemented and validated.

## Requirements

### Export Validation
All correlation graph exports must:
- Be generated by `scripts/export_graph.py` → `exports/graph_correlation_network.json`
- Include NetworkX-based metrics when available (avg_weighted_degree, clustering_coeff, components)
- Provide fallback metrics when NetworkX unavailable
- Filter correlations by configurable threshold (default ≥0.4)
- Include statistical significance indicators (p_value < 0.05)

### Web UI Integration
- `CorrelationExplorer.tsx` must exist and be functional
- Component must load from `/exports/graph_correlation_network.json`
- Support interactive filtering by correlation strength (0–1 slider)
- Display network topology with proper visual encoding
- Show statistical summaries and top connections

### Schema Compliance
- Correlation network exports must be structurally valid JSON
- Follow established patterns from `graph-stats.schema.json`
- Include required metadata fields (node_count, edge_count, etc.)

### Reporting Integration
- `scripts/generate_report.py` must include "Correlation Network Analytics" section
- Display top 10 strongest connections in tabular format
- Show network metrics and summary statistics
- Include significance indicators and cluster mappings

## Validation Gates

### CI/CD Integration
- `scripts/rules_guard.py` validates correlation exports exist when correlation data present
- Schema validation fails closed (prevents bad correlation exports)
- Web UI component presence verified during build
- Evidence markers required: `correlation_network`, `correlation_explorer`

### Development Checks
- Export functions tested with mock correlation data
- Web UI component renders with empty/error states
- NetworkX dependency handled gracefully
- Interactive filtering verified functional

## Enforcement

### Build Requirements
- `npm run type-check` passes for CorrelationExplorer.tsx
- `npm run test:ci` includes correlation component tests
- Export script runs without errors when correlation data available
- Report generation includes correlation section

### Runtime Validation
- Correlation explorer loads successfully in browser
- Filtering controls update visualization in real-time
- Network metrics display correctly
- Error states handled gracefully

## Related Rules
- **000**: Always-Apply (production safety)
- **006**: AGENTS.md Governance
- **013**: Report Verification
- **021**: Stats Proof (export validation)
- **022**: Visualization Contract Sync
- **030**: Pattern Correlation Validation

## Implementation Notes

- CorrelationExplorer component uses Visx for graph rendering
- NetworkX optional dependency with graceful fallback
- Threshold filtering prevents overwhelming large networks
- Statistical significance indicated through visual encoding
- Component follows existing Web UI patterns and styling