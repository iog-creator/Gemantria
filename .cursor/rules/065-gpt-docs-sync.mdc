---
description: GPT System Prompt and Reference Guide synchronization requirements
globs:
  - "docs/SSOT/GPT_SYSTEM_PROMPT.md"
  - "docs/SSOT/GPT_REFERENCE_GUIDE.md"
  - "scripts/governance_tracker.py"
  - "scripts/governance_housekeeping.py"
alwaysApply: true
---

# 065 — GPT Documentation Sync (AlwaysApply)

## Intent

Ensure `docs/SSOT/GPT_SYSTEM_PROMPT.md` and `docs/SSOT/GPT_REFERENCE_GUIDE.md` remain current with operational changes, especially:
- DB/service availability handling (Rule 046)
- Governance framework updates
- Operational workflow changes
- Quality gate modifications

## Trigger Conditions

Update GPT documentation when ANY of the following change:

1. **DB/Service Handling**: Changes to how scripts handle unavailable databases or services
2. **Governance Rules**: New rules added or existing rules modified (especially Rule 046, 050, 051, 059, 061)
3. **Operational Workflows**: Changes to `make housekeeping`, validation procedures, or quality gates
4. **Response Standards**: Modifications to 4-block format, evidence requirements, or tool priority
5. **Hermetic Behavior**: Updates to how scripts handle missing dependencies or services

## Required Updates

### GPT_SYSTEM_PROMPT.md

When operational changes occur, update:

1. **Hermetic Behavior Section**: Add/update DB unavailability handling guidance
2. **Quality Validation**: Update validation steps if procedures change
3. **Version Control**: Update version number and "Last Updated" date
4. **Related Governance**: Add new rules to the governance reference list
5. **Core System Prompt**: Update the embedded prompt text if operational contracts change

### GPT_REFERENCE_GUIDE.md

When operational changes occur, update:

1. **Validation Checklist**: Update checklist items if validation procedures change
2. **Hermetic Behavior Section**: Document new DB/service handling patterns
3. **Governance Reference**: Add references to new rules or ADRs
4. **Usage Guidelines**: Update if workflow or tool usage changes

## Update Process

1. **Identify Change**: Recognize when operational behavior changes (e.g., DB handling, new rules)
2. **Update Both Files**: Modify both `GPT_SYSTEM_PROMPT.md` and `GPT_REFERENCE_GUIDE.md`
3. **Version Bump**: Increment version in `GPT_SYSTEM_PROMPT.md` (e.g., 1.0 → 1.1)
4. **Update Date**: Set "Last Updated" to current version/phase
5. **Commit**: Include GPT docs updates in the same PR as the operational change

## Examples

### Example 1: DB Unavailability Handling

**Change**: `governance_tracker.py` now handles DB unavailability gracefully

**Required Updates**:
- Add "Hermetic Behavior (DB/Service Availability)" section to `GPT_SYSTEM_PROMPT.md`
- Add "Hermetic Behavior" section to `GPT_REFERENCE_GUIDE.md`
- Update version to 1.1 in `GPT_SYSTEM_PROMPT.md`
- Add Rule 046 to "Related Governance" in both files

### Example 2: New Quality Gate

**Change**: New validation step added to `make housekeeping`

**Required Updates**:
- Update "Quality Validation" section in `GPT_SYSTEM_PROMPT.md`
- Update "Validation Checklist" in `GPT_REFERENCE_GUIDE.md`
- Update version and date

## Hints for Documentation/Rule Changes

Per Rule 026 (Hints Envelope), changes to rules or documentation automatically emit hints:

- **Automatic Detection**: `scripts/governance_docs_hints.py` runs during `make housekeeping`
- **Hints Envelope**: Changes are tracked in `evidence/governance_docs_hints.json` (file-based, no DB required)
- **Hermetic**: Works without database (Rule 046 compliance)
- **Detection**: Monitors `.cursor/rules/`, `docs/SSOT/`, `AGENTS.md`, `RULES_INDEX.md` for modifications
- **GPT Docs**: Specifically detects updates to GPT documentation files (Rule 065 trigger)

Hints are emitted as:
- `governance.docs: N rule/doc file(s) modified`
- `governance.rules: New rule detected: <rule-name>`
- `governance.gpt: GPT documentation updated: <filename> (Rule 065)`

## Enforcement

- **Pre-commit**: Check if operational changes require GPT docs updates
- **PR Review**: Verify GPT docs are updated when operational contracts change
- **Housekeeping**: Include GPT docs sync in `make housekeeping` validation
- **Hints**: Automatic hint emission via `governance.docs.hints` target (integrated into `make housekeeping`)

## Related Rules

- **Rule 046**: Hermetic CI Fallbacks (DB unavailability handling)
- **Rule 050**: OPS Contract (evidence-first workflow)
- **Rule 051**: Cursor Insight & Handoff (structured responses)
- **Rule 055**: Auto-Docs Sync Pass (documentation synchronization)
- **Rule 059**: Context Persistence (maintain operational context)
- **Rule 061**: AI Learning Tracking (session monitoring)
- **ADR-058**: GPT System Prompt Requirements as Operational Governance

## Notes

- GPT documentation must reflect current operational reality
- Version numbers should increment with substantive changes
- Both files should be updated together to maintain consistency
- Changes to operational contracts require immediate GPT docs updates
