---
description: Governance for AGENTS.md (always-on)
alwaysApply: false
---

# AGENTS.md Governance — How agents must use and maintain AGENTS.md

## Read-before-act
- Before performing any multi-step or repo-wide task (scaffold, DB work, CI edits, PR ops), READ `AGENTS.md` and follow its workflow, priorities, and gates.
- If a needed instruction is missing, propose a patch to `AGENTS.md` in the same PR (DoR/DoD below).

## Automatic Housekeeping Enforcement
- **MANDATORY**: Run `make housekeeping` after ANY changes to docs, scripts, rules, or database
- **MANDATORY**: Run `make ssot.verify` before any database operations
- **MANDATORY**: Emit LOUD hints for any governance violations (see Rule 061)
- **AUTOMATIC**: Check for new hint envelopes in `share/evidence/` directory
- **AUTOMATIC**: Validate all .mdc rules are properly formatted and cross-referenced
- **DSN Access**: All database operations must use centralized DSN loaders (`scripts.config.env` preferred, `src.gemantria.dsn` legacy). Never use `os.getenv("GEMATRIA_DSN")` directly - enforced by `guard.dsn.centralized`.

## Canonical sections required in AGENTS.md
- Mission & priorities (e.g., Code > bible_db > LLM; determinism; safety).
- Environment setup (venv, deps, `.env.example`), and how to run tests/gates.
- Definitions of Done & Ready:
  - **DoR** (ready): tests planned, ADR touched if schema/behavior changes, gates runnable.
  - **DoD** (done): tests pass, coverage gate met, ADR updated, rules updated if behavior changes.
- PR workflow (branch naming, commit style, CI targets).
- Security/Safety (no mocks, read-only DB policy, param SQL).
- Quick commands (one-liners for common tasks).

## Change policy (keep docs in lockstep)
- **MANDATORY**: Any change to workflows, gates, or safety rules MUST update `AGENTS.md` in the same PR and adjust tests/CI accordingly.
- **MANDATORY**: Code changes in a directory MUST update that directory's `AGENTS.md` file if:
  - New functions/classes/components are added
  - API contracts or interfaces change
  - Key behavior or patterns change
  - Dependencies or integration points change
- **AUTOMATIC CHECK**: `scripts/check_agents_md_sync.py` detects when code changes should trigger AGENTS.md updates
- **AUTOMATIC CREATION**: `scripts/create_agents_md.py` creates missing AGENTS.md files with appropriate templates
- If instructions in chat conflict with `AGENTS.md`, follow the chat for this task but OPEN A FOLLOW-UP PATCH to reconcile and update `AGENTS.md`.

## Verification checklist (agents enforce)
- Commands shown in AGENTS.md are executable (no typos).
- Coverage threshold matches CI config.
- PR template in AGENTS.md includes Goal/Files/Tests/Acceptance and links to ADRs/rules touched.
- **AGENTS.md sync check**: Run `python scripts/check_agents_md_sync.py` to detect stale documentation
- **Missing files check**: Run `python scripts/create_agents_md.py --dry-run` to find missing AGENTS.md files

## Mandatory Cross-References
- **Rule 030**: Share directory synchronization (always run after changes)
- **Rule 058**: Auto-housekeeping (mandatory after any modifications)
- **Rule 061**: AI learning tracking (emit hints for violations)
- **docs/SSOT/GPT_SYSTEM_PROMPT.md**: AI operational governance
- **docs/SSOT/SHARE_MANIFEST.json**: Share synchronization manifest

## Minimal PR template (to embed in PR body)
- Goal:
- Files changed:
- Tests added/updated:
- Acceptance (lint, type, tests, coverage ≥X, safety checks):
- ADRs/rules touched:
