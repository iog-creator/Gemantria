---
description: Production safety and live model enforcement
globs:
  - src/graph/graph.py
  - src/services/lmstudio_client.py
  - scripts/generate_report.py
alwaysApply: false
---

- **Qwen Live Gate**: Pipeline must call assert_qwen_live() before any network aggregation; fail-closed unless verified.
- **Health Check Requirements**: Verify model availability, test embeddings (1024-dim), measure latency for both embedder and reranker.
- **Production Mode**: USE_QWEN_EMBEDDINGS=true required; ALLOW_MOCKS_FOR_TESTS=0 in production (only 1 for unit tests).
- **Fail-Closed Behavior**: QwenUnavailableError on any health check failure; no silent fallback to mocks in production code.
- **Environment Validation**: QWEN_EMBEDDING_MODEL and QWEN_RERANKER_MODEL must match actual LM Studio loaded models.
- **Health Logging**: All health checks logged to qwen_health_log table with run_id, verification status, latencies.
- **Report Integration**: Qwen Live Verification section must show verified=true, model names, dimensions, latencies.
- **CI Targets**: make check.qwen validates health; make test.live runs with ALLOW_MOCKS_FOR_TESTS=0.
- **Model Validation**: Embedding models tested with /v1/embeddings; reranker models tested with /v1/chat/completions.
- **Evidence Requirements**: Production runs must provide undeniable proof of live inference (DB logs + report verification).