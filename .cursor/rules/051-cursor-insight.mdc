---
description: Cursor Insight & Handoff
alwaysApply: true
globs: []
---
# 051 — Cursor Insight & Handoff (AlwaysApply)

## Intent

Cursor must stop exploratory / unfocused tool flurries and instead **emit the exact evidence set** the PM agent needs. This rule anchors to the OPS Contract (050) and the PR Merge Policy (041).

## Triggers

- PR is *mergeable* but appears "blocked" by a **non-required** automated review (Sourcery, Copilot, Snyk, etc.)
- PR is rebased on `main` and needs verification gates
- Operator asks for "handoff", "next chat", or "prepare evidence"

## Required Evidence Set

Cursor **must** paste, in this order:

1. `git rev-parse --show-toplevel`
2. `git rev-parse --abbrev-ref HEAD`
3. `git status -sb`
4. One hermetic block (all 3, even if they no-op):
   - `ruff format --check . && ruff check .`
   - `make book.smoke`
   - `make ci.exports.smoke`
5. For the active PR **N**:
   - `gh pr view <N> --json number,title,headRefName,baseRefName,state,author,reviews,reviewDecision,mergeable,mergeStateStatus,checks`
   - `gh pr checks <N> --required --json name,state`
6. If `gh pr checks ...` shows **all required = SUCCESS**, Cursor must **explicitly state**:
   > "Non-required automated review present → advisory only per 041 + 050. Standard merge allowed."
7. **Browser verification (REQUIRED when applicable)**: If the work involves web pages, HTML, UI components, documentation sites, or any visual outputs:
   - Use `browser_snapshot` to capture accessibility snapshots of rendered pages
   - Use `browser_take_screenshot` for visual verification of layouts, styling, or rendering
   - Navigate to local files using `file://` URLs or serve pages locally and verify
   - Verify links, navigation, and interactive elements work correctly
   - Include browser verification evidence in the handoff output

## Non-Required Review Rule

- If the review is **not** part of GitHub's "required" checks and **not** in CODEOWNERS → treat as **advisory**.
- Cursor **must not** stop or say "blocked" if: ruff ✅, build ✅, required checks ✅.
- Cursor **may** note: "If you have admin you can dismiss the stale automated review."

## Handoff Format

When a handoff is requested, Cursor must output **4 blocks only**:

1. **Goal** — single sentence, present tense
2. **Commands** — runnable shell, in order
3. **Evidence to return** — numbered list tied to the commands
4. **Next gate** — what the PM/next chat will do

No extra narrative, no speculation.

## Browser Verification Requirement

Cursor **must** use the integrated browser tool to visually verify results when:
- Generating or modifying web pages, HTML files, or documentation that renders in a browser
- Creating UI components, dashboards, charts, or visualizations
- Working with GitHub Pages, documentation sites, or any web-based outputs
- Verifying visual layout, styling, CSS, or rendering issues
- Checking links, navigation, forms, or interactive elements
- Validating that generated content displays correctly

**Browser tools available**:
- `browser_snapshot`: Capture accessibility snapshot (preferred for structure/content verification)
- `browser_take_screenshot`: Capture visual screenshot (preferred for layout/styling verification)
- `browser_navigate`: Navigate to URLs or local files
- `browser_click`, `browser_type`, etc.: Interact with pages when needed

**When to verify**:
- After generating HTML/Markdown that will be rendered
- After modifying CSS, styling, or layout code
- After creating or updating documentation sites
- After generating visualizations, charts, or dashboards
- Before marking visual/UI work as complete

## Notes

- This rule is **AlwaysApply** for Gemantria
- This rule depends on: 039, 041, 046, 050
- Browser verification is **mandatory** for visual/web outputs, not optional
