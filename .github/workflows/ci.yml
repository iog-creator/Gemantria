name: CI
on: [push, pull_request]
jobs:
  verify:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-python@v5
        with:
          python-version: "3.11"
      - name: Setup venv
        run: |
          python -m venv .venv
          . .venv/bin/activate
          pip install --upgrade "psycopg[binary]" pgvector requests python-dotenv
      - name: Bootstrap (no secrets)
        run: |
          cp -f env_example.txt .env
          echo "ALLOW_PARTIAL=1" >> .env
          echo "ENFORCE_QWEN_LIVE=0" >> .env   # CI skips real LM Studio
      - name: Doctor (non-fatal in CI)
        run: |
          . .venv/bin/activate
          set -a && source .env && set +a
          python scripts/doctor.py || true
      - name: Docs/rules presence
        run: |
          test -f .cursor/rules/009-documentation-sync.mdc
          test -f AGENTS.md
          test -f docs/ADRs
