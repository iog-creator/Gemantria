name: rc-smokes

on:
  workflow_dispatch: {}
  # OPS v6.2.3: schedule disabled to stop failing nightlies. Run manually when needed.

jobs:
  rc:
    name: RC Hermetic Smokes
    runs-on: ubuntu-latest
    concurrency:
      group: rc-smokes
      cancel-in-progress: true
    permissions:
      contents: read
    env:
      MOCK_AI: "1"
      SKIP_DB: "1"
      EDGE_STRONG: "${{ vars.EDGE_STRONG || '0.90' }}"
      EDGE_WEAK:   "${{ vars.EDGE_WEAK   || '0.75' }}"
      CANDIDATE_POLICY: "${{ vars.CANDIDATE_POLICY || 'cache' }}"
      PIPELINE_SEED: "4242"
    steps:
      - uses: actions/checkout@08c6903cd8c0fde910a37f88322edcfb5dd907a8 # v4 pinned
      - name: SSOT + governance gates
        run: |
          ruff format --check . && ruff check .
          make -s ops.verify
      - name: Hermetic RC smokes
        run: |
          make -s ci.pipeline.smoke
          make -s ci.exports.smoke
          make -s ci.webui.smoke
          make -s ci.webui.temporal.smoke
          make -s ci.quality.smoke
          make -s ci.pipeline.meta
          make -s docs.smoke
