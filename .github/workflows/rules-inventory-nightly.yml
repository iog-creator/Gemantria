name: rules-inventory-nightly

on:
  schedule:
    - cron: "17 7 * * *"  # 7:17 AM UTC daily

jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
      - uses: actions/setup-python@v5
        with:
          python-version: '3.11'
      - name: Re-generate inventory and share; commit if changed
        run: |
          make -s share.sync || true
          python3 scripts/guards/generate_rules_inventory.py
          if ! git diff --quiet -- AGENTS.md share/; then
            git config user.name "ops-bot"
            git config user.email "ops@example.com"
            git add AGENTS.md share/
            git commit -m "nightly: refresh RULES_INVENTORY + share mirror"
            git push
          fi

